function generateSchoolSelect(t){for(var e,a=[],n=[],o=0;o<t.length;o++){a.push(t[o].name),n.push(t[o].id);t[o];e+='<option value="'+t[o].url+t[o].id+'" >'+t[o].name+"</option>"}$("#school-list").html(e)}function getDashboardBySchoolID(t){$(".loader").show(),$.ajax({url:t,headers:{Authorization:"3b8c568f-732d-11e6-8249-9801a7aad89d"},method:"GET",success:function(t){var e=t.results||[];e.reverse(),$("body").css({background:"white"}),$(".loader").hide(),$("#container").show(),handleData(e)}})}function handleData(t){data=t;for(var e=[],a=0;a<t.length;a++)for(var n in t[a])t[a].hasOwnProperty(n)&&e.indexOf(n)===-1&&"id"!==n&&e.push(n);for(var o=[],a=0;a<e.length;a++){for(var r=[],d=0;d<t.length;d++){var i=t[d][e[a]];r.push(i||(0==i?"0":""))}o.push(r)}for(var l=[],a=0;a<e.length;a++)"date"!==e[a]&&l.push({name:e[a],type:"line",data:o[a]});for(var c=[],a=0;a<e.length;a++)"date"!==e[a]&&c.push(e[a]);var h={baseOption:{title:{text:""},tooltip:{},grid:{bottom:"18%",left:"10%"},legend:{data:c,formatter:function(t){var e;return"photocount"===t?e="照片数量":"attendancecount"===t?e="考勤数量":"studentcount"===t&&(e="学生人数"),e}},xAxis:{data:o[o.length-1],axisLabel:{interval:0,formatter:function(t,e){return t}}},yAxis:{},series:l,animationEasing:"elasticOut",animationDelayUpdate:function(t){return 10*t},toolbox:{show:!0,feature:{myDataView:{show:!0,title:"数据视图",icon:"M17.5,17.3H33 M17.5,17.3H33 M45.4,29.5h-28 M11.5,2v56H51V14.8L38.4,2H11.5z M38.4,2.2v12.7H51 M45.4,41.7h-28",onclick:function(){var t=$("#data-view"),e=$("#modal-body");t.css({display:"block"}),e.empty(),e.append(buildHtmlTable(data)),$(".close").click(function(){t.css({display:"none"})}),t.click(function(t){})}},magicType:{type:["line","bar"]},saveAsImage:{}}}}};myChart.setOption(h)}function buildHtmlTable(t){for(var e=_table_.cloneNode(!1),a=addAllColumnHeaders(t,e),n=0,o=t.length;n<o;++n){for(var r=_tr_.cloneNode(!1),d=0,i=a.length;d<i;++d){var l=_td_.cloneNode(!1),c=t[n][a[d]];l.appendChild(document.createTextNode(c||(0==c?"0":""))),r.appendChild(l)}e.appendChild(r)}return e}function addAllColumnHeaders(t,e){for(var a=[],n=_tr_.cloneNode(!1),o=0,r=t.length;o<r;o++)for(var d in t[o])if(t[o].hasOwnProperty(d)&&a.indexOf(d)===-1&&"id"!==d){a.push(d);var i=_th_.cloneNode(!1);"photocount"===d?d="照片数量":"name"===d?d="学校名称":"attendancecount"===d?d="考勤数量":"date"===d?d="日期":"studentcount"===d&&(d="学生人数"),i.appendChild(document.createTextNode(d)),n.appendChild(i)}return e.appendChild(n),a}var _table_=document.createElement("table"),_tr_=document.createElement("tr"),_th_=document.createElement("th"),_td_=document.createElement("td"),myChart=echarts.init(document.getElementById("main")),data;$(document).ready(function(){$("#container").hide();var t=$.ajax({url:"http://v2.taidii.com/api/cncenterlist/",headers:{Authorization:"3b8c568f-732d-11e6-8249-9801a7aad89d"},method:"GET"}),e=$.ajax({url:"http://www.taidii.cn/api/cncenterlist/",headers:{Authorization:"3b8c568f-732d-11e6-8249-9801a7aad89d"},method:"GET"});$.when(t,e).done(function(t,e){for(var a=t[0].results||[],n=e[0].results||[],o=0;o<a.length;o++)a[o].url="http://v2.taidii.com/api/cndashboard/?id=";for(var r=0;r<n.length;r++)n[r].url="http://www.taidii.cn/api/cndashboard/?id=";getDashboardBySchoolID(a[0].url+a[0].id),generateSchoolSelect(a.concat(n)),$("#school-list").change(function(){var t=$(this);getDashboardBySchoolID(t.val())})})});